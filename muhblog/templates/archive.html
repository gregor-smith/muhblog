{% extends "base.html" %}

{% macro entry_line(entry) %}
    <li><a href="/{{ entry.datetime_written.year }}/{{ entry.datetime_written.month }}/{{ entry.datetime_written.day }}/{{ entry.title_slug }}">{{ entry.title }}</a></li>
{% endmacro %}

{% macro day(entry) %}
    <a href="/{{ entry.datetime_written.year }}/{{ entry.datetime_written.month }}/{{ entry.datetime_written.day }}">{{ entry.datetime_written.day }}</a>
    <ul>
        {{ entry_line(entry) }}
{% endmacro %}

{% macro month(entry) %}
    <ul>
        <li>
            <a href="/{{ entry.datetime_written.year }}/{{ entry.datetime_written.month }}">{{ entry.datetime_written.month }}</a>
            <ul>
                <li>
{% endmacro %}

{% set last_year = 9999 %}
{% set last_month = 99 %}
{% set last_day = 99 %}

{% block content %}
    <ul>
        {% for entry in entries %}
            {% if entry.datetime_written.year < last_year %}
                {% if last_year != 9999 %}
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                {% endif %}
                <li>
                    <a href="/{{ entry.datetime_written.year }}">{{ entry.datetime_written.year }}</a>
                {{ month(entry) }}
                    {{ day(entry) }}
                {% set last_year = entry.datetime_written.year %}
                {% set last_month = entry.datetime_written.month %}
                {% set last_day = entry.datetime_written.day %}
            {% elif entry.datetime_written.month < last_month %}
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
                {{ month(entry) }}
                    {{ day(entry) }}
                {% set last_month = entry.datetime_written.month %}
                {% set last_day = entry.datetime_written.day %}
            {% elif entry.datetime_written.day < last_day %}
                    </ul>
                </li>
                <li>
                    {{ day(entry) }}
                {% set last_day = entry.datetime_written.day %}
            {% elif entry.datetime_written.day == last_day %}
                {{ entry_line(entry) }}
            {% endif %}
        {% endfor %}
    </ul>
{% endblock %}
